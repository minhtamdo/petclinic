<!DOCTYPE html>
<html lang="vi">
<head>
    {% csrf_token %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Quản Lý Thú Cưng</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            border: none;
            background: none;
            font-size: 16px;
        }

        .tab:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .service-card {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            color: white;
        }

        .service-card:hover {
            transform: translateY(-5px);
        }

        .service-card h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .service-card p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .price {
            font-size: 1.8em;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .pet-list{
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .pet-item{
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .pet-item h4{
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            color: white;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .delete-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }

        .delete-btn:hover {
            background: #ff5252;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 1 50%;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .service-grid {
                grid-template-columns: 1fr;
            }
        }

        .pet-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .pet-header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .pet-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .pet-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-top: 30px;
        }

        .pet-card {
            border: 1px solid #e0e0e0;
            padding: 15px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .pet-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .pet-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
            background: #f8f9fa;
        }

        .pet-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .species-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .pet-info {
            flex: 1;
            margin-bottom: 15px;
        }

        .pet-info p {
            margin: 8px 0;
            color: #555;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pet-info strong {
            color: #333;
            min-width: 80px;
            font-weight: 600;
        }

        .pet-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        .btn-detail {
            flex: 1;
            padding: 10px 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-detail:hover {
            background: linear-gradient(45deg, #5a6fd8, #6a4190);
            transform: translateY(-1px);
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border: none;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }

        .close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 25px;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .pet-list {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .pet-container {
                padding: 15px;
            }
            
            .pet-list {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .pet-header h2 {
                font-size: 1.5rem;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }

            .pet-info strong {
                min-width: 70px;
            }
        }
        .modal-tabs {
            display: flex;
            gap: 10px;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .tab-button {
            background: #eee;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
        }
        .tab-button.active {
            background: #fff;
            border-bottom: 2px solid #007bff;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .tab-content.active {
            display: block;
            animation: fadeInUp 0.5s ease-out;
        }

        /* Tiêu đề */
        .tab-content h2 {
            color: #2c5aa0;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 25px;
            padding-bottom: 10px;
            text-align: center;
        }

        /* Form Group */
        .form-group {
            margin-bottom: 20px;
        }

        /* Button styles */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Form Appointment */
        .appointmentForm {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            margin-top: 20px;
        }

        /* Labels */
        .appointmentForm label {
            display: block;
            margin-bottom: 8px;
            margin-top: 20px;
            font-weight: 600;
            color: #495057;
            font-size: 15px;
        }

        .appointmentForm label:first-of-type {
            margin-top: 0;
        }

        /* Input và Select styles */
        .appointmentForm input[type="text"],
        .appointmentForm input[type="date"],
        .appointmentForm select,
        .appointmentForm textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
            box-sizing: border-box;
            background: white;
        }

        .appointmentForm input[type="text"]:focus,
        .appointmentForm input[type="date"]:focus,
        .appointmentForm select:focus,
        .appointmentForm textarea:focus {
            border-color: #17a2b8;
            outline: none;
            box-shadow: 0 0 0 3px rgba(23, 162, 184, 0.1);
            background: #fff;
        }

        /* Select specific styling */
        .appointmentForm select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        /* Textarea */
        .appointmentForm textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        /* Submit button */
        .appointmentForm button[type="submit"] {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 25px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .appointmentForm button[type="submit"]:hover {
            background: linear-gradient(135deg, #218838, #1ba885);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }

        /* Pagination Controls */
        .pagination-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        /* Search Box */
        .search-box {
            flex: 1;
            min-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: white;
            box-sizing: border-box;
        }

        .search-box input:focus {
            border-color: #17a2b8;
            outline: none;
            box-shadow: 0 0 0 3px rgba(23, 162, 184, 0.1);
        }

        /* Items per page */
        .items-per-page {
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .items-per-page label {
            font-weight: 600;
            color: #495057;
        }

        .items-per-page select {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .items-per-page span {
            color: #6c757d;
            font-size: 14px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .tab-content {
                margin: 10px;
                padding: 15px;
            }
            
            .tab-content h2 {
                font-size: 24px;
            }
            
            .appointmentForm {
                padding: 20px;
            }
            
            .pagination-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                min-width: unset;
            }
            
            .items-per-page {
                justify-content: center;
            }
            
            .btn {
                width: 100%;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .appointmentForm input[type="text"],
            .appointmentForm input[type="date"],
            .appointmentForm select,
            .appointmentForm textarea {
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .appointmentForm button[type="submit"] {
                padding: 12px 30px;
                font-size: 15px;
            }
        }

        /* Status colors cho select options */
        .appointmentForm select[name="status"] option[value="PENDING"] {
            background-color: #fff3cd;
            color: #856404;
        }

        .appointmentForm select[name="status"] option[value="CONFIRMED"] {
            background-color: #d4edda;
            color: #155724;
        }

        /* Hover effects cho form elements */
        .appointmentForm input[type="text"]:hover,
        .appointmentForm input[type="date"]:hover,
        .appointmentForm select:hover,
        .appointmentForm textarea:hover {
            border-color: #adb5bd;
        }

        /* Loading state (có thể dùng khi fetch data) */
        .loading {
            opacity: 0.6;
            pointer-events: none;
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #dee2e6;
            border-top: 2px solid #17a2b8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error state */
        .error {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1) !important;
        }

        /* Success state */
        .success {
            border-color: #28a745 !important;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1) !important;
        }

        .pet-properties{
            display: none;
        }
        .pet-properties.active {
            display: block;
        }

        .nutrition-item {
            margin-bottom: 12px;
            padding: 10px;
            border-left: 4px solid #ff9900;
            background-color: #fff8e1;
            border-radius: 6px;
        }

        .vaccination-item {
            margin-bottom: 12px;
            padding: 10px;
            border-left: 4px solid #ff9900;
            background-color: #fff8e1;
            border-radius: 6px;
        }

        .service-item {
            margin-bottom: 12px;
            padding: 10px;
            border-left: 4px solid #ff9900;
            background-color: #fff8e1;
            border-radius: 6px;
        }
        
        .medical-item {
            margin-bottom: 12px;
            padding: 10px;
            border-left: 4px solid #ff9900;
            background-color: #fff8e1;
            border-radius: 6px;
        }
        .pet-search {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .pet-search input {
            width: 100%;
            padding: 18px 50px 18px 20px;
            font-size: 16px;

            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-clip: padding-box;

            background: #ffffff;
            color: #2d3748;

            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 500;
            letter-spacing: 0.01em;

            box-shadow:
                0 10px 25px rgba(0, 0, 0, 0.1),
                0 5px 10px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
        }

        .pet-search::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50px;
            padding: 2px;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 300% 300%;
            animation: gradientShift 4s ease infinite;
            z-index: -1;
        }

        .pet-search::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            background: white;
            border-radius: 48px;
            z-index: -1;
        }

        .pet-search .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .pet-search .search-icon::before {
            content: "🔍";
        }

        .pet-search:hover input {
            transform: translateY(-2px);
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.15),
                0 8px 15px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .pet-search:hover .search-icon {
            transform: translateY(-50%) scale(1.1);
        }

        .pet-search input:focus {
            transform: translateY(-3px);
            box-shadow: 
                0 20px 40px rgba(102, 126, 234, 0.2),
                0 10px 20px rgba(102, 126, 234, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .pet-search input::placeholder {
            color: #a0aec0;
            font-weight: 400;
            font-style: italic;
            opacity: 0.8;
        }

        .pet-search input {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        /* ========================================
        APPOINTMENT LIST WINDOW STYLES
        ======================================== */

        /* Main Window Container */
        #newAppointmentWindow {
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #newAppointmentWindow h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Switch Button Styles */
        .form-group .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-group .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* Main Content Container */
        #newAppointmentWindow > div[style*="background: #f8f9fa"] {
            background: #ffffff !important;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: none !important;
        }

        #newAppointmentWindow h3 {
            color: #34495e;
            font-size: 24px;
            margin-bottom: 25px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        /* ========================================
        APPOINTMENT LIST CONTAINER
        ======================================== */

        .list-appointments {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%) !important;
            padding: 25px !important;
            border-radius: 12px !important;
            border: 1px solid #2196f3;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
        }

        /* ========================================
        INDIVIDUAL APPOINTMENT CARDS
        ======================================== */

        .appointment {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-left: 5px solid #3498db;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .appointment::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3498db, #2ecc71, #f39c12);
        }

        .appointment:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .appointment:last-child {
            margin-bottom: 0;
        }

        /* ========================================
        APPOINTMENT HEADER
        ======================================== */

        .appointment > div:first-child {
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 15px;
            margin-bottom: 15px !important;
        }

        .appointment > div:first-child strong {
            color: #2c3e50 !important;
            font-size: 18px !important;
            font-weight: 700;
        }

        .appointment > div:first-child span {
            background: #3498db;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Status Color Variations */
        .appointment[ap-status="pending"] > div:first-child span {
            background: #f39c12;
        }

        .appointment[ap-status="confirmed"] > div:first-child span {
            background: #2ecc71;
        }

        .appointment[ap-status="completed"] > div:first-child span {
            background: #95a5a6;
        }

        .appointment[ap-status="cancelled"] > div:first-child span {
            background: #e74c3c;
        }

        /* ========================================
        APPOINTMENT DETAILS GRID
        ======================================== */

        .appointment > div[style*="display: grid"] {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 15px !important;
            margin-bottom: 15px !important;
        }

        .appointment > div[style*="display: grid"] > div {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #3498db;
            font-size: 14px;
        }

        .appointment > div[style*="display: grid"] > div strong {
            color: #2c3e50;
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
        }

        /* ========================================
        APPOINTMENT NOTES
        ======================================== */

        .appointment > div[style*="font-style: italic"] {
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%) !important;
            border: 1px solid #ffeb3b;
            border-radius: 8px !important;
            padding: 12px !important;
            margin-top: 15px !important;
            font-style: normal !important;
            color: #f57f17;
            font-weight: 500;
            position: relative;
        }

        .appointment > div[style*="font-style: italic"]::before {
            content: '💡';
            margin-right: 8px;
        }

        /* ========================================
        APPOINTMENT TIMESTAMPS
        ======================================== */

        .appointment > div[style*="font-size: 12px"] {
            background: #ecf0f1;
            padding: 8px 12px;
            border-radius: 6px;
            margin-top: 15px !important;
            font-size: 11px !important;
            color: #7f8c8d !important;
            border-top: 1px solid #bdc3c7;
        }

        /* ========================================
        EMPTY STATE
        ======================================== */

        .list-appointments p[style*="background: #fff3cd"] {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%) !important;
            border: 2px dashed #fdcb6e !important;
            border-radius: 12px !important;
            padding: 30px !important;
            text-align: center;
            font-size: 16px;
            font-weight: 500;
            color: #d63031 !important;
        }

        /* ========================================
        RESPONSIVE DESIGN
        ======================================== */

        @media (max-width: 768px) {
            #newAppointmentWindow {
                padding: 15px;
            }
            
            .appointment > div[style*="display: grid"] {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }
            
            .appointment {
                padding: 15px;
            }
            
            #newAppointmentWindow h2 {
                font-size: 24px;
            }
            
            .appointment > div:first-child {
                flex-direction: column;
                align-items: flex-start !important;
                gap: 10px;
            }
            
            .appointment > div:first-child span {
                align-self: flex-start;
            }
        }

        @media (max-width: 480px) {
            .list-appointments {
                padding: 15px !important;
            }
            
            .appointment > div:first-child strong {
                font-size: 16px !important;
            }
            
            .form-group .btn {
                width: 100%;
                text-align: center;
            }
        }

        /* ========================================
        ANIMATION CLASSES
        ======================================== */

        .appointment {
            animation: slideInUp 0.3s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========================================
        HOVER EFFECTS
        ======================================== */

        .appointment > div[style*="display: grid"] > div:hover {
            background: #e8f4f8;
            transform: translateX(5px);
            transition: all 0.2s ease;
        }

        /* ========================================
        PRINT STYLES
        ======================================== */

        @media print {
            #newAppointmentWindow {
                background: white;
                padding: 0;
            }
            
            .appointment {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            .form-group .btn {
                display: none;
            }
        }
        body {
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    margin: 0;
                    padding: 20px;
                    background-color: #f5f5f5;
                }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }


        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .list-appointments {
            margin-top: 20px;
            padding: 15px;
            background: #d1ecf1;
            border-radius: 5px;
        }

        .appointment {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }

        .appointment:last-child {
            margin-bottom: 0;
        }

        .status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .status.confirmed {
            background: #d4edda;
            color: #155724;
        }

        .status.completed {
            background: #cce5ff;
            color: #004085;
        }

        .status.cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            background: white;
            color: #495057;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .pagination button:hover:not(:disabled) {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .pagination button.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .pagination button:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
        }

        .pagination-info {
            margin: 20px 0;
            text-align: center;
            color: #6c757d;
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .items-per-page {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .items-per-page select {
            padding: 5px 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: white;
        }

        .search-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-box input {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            width: 200px;
        }

        @media (max-width: 768px) {
            .pagination {
                gap: 5px;
            }
            
            .pagination button {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .pagination-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box input {
                width: 100%;
            }
        }
        .appointmentForm {
            max-width: 500px;
            margin: 40px auto;
            padding: 30px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(245, 247, 250, 0.9));
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Form Labels */
        .appointmentForm label {
            display: block;
            margin-bottom: 8px;
            margin-top: 20px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .appointmentForm label:first-child {
            margin-top: 0;
        }

        /* Input Fields */
        .appointmentForm input[type="text"],
        .appointmentForm input[type="date"],
        .appointmentForm select,
        .appointmentForm textarea {
            width: 100%;
            padding: 15px 20px;
            margin-bottom: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            background: rgba(255, 255, 255, 0.9);
            color: #2c3e50;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        /* Focus States */
        .appointmentForm input[type="text"]:focus,
        .appointmentForm input[type="date"]:focus,
        .appointmentForm select:focus,
        .appointmentForm textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 1);
        }

        /* Select Dropdown */
        .appointmentForm select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 15px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 45px;
        }

        .appointmentForm select option {
            padding: 10px;
            background: white;
            color: #2c3e50;
            font-size: 14px;
        }

        /* Textarea */
        .appointmentForm textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
            line-height: 1.5;
        }

        /* Submit Button */
        .appointmentForm button[type="submit"] {
            width: 100%;
            padding: 16px 24px;
            margin-top: 20px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .appointmentForm button[type="submit"]:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
            background: linear-gradient(135deg, #2980b9, #1f4e79);
        }

        .appointmentForm button[type="submit"]:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        /* Remove default <br> spacing and add proper margins */
        .appointmentForm br {
            display: none;
        }

        /* Placeholder styling */
        .appointmentForm input::placeholder,
        .appointmentForm textarea::placeholder {
            color: #95a5a6;
            font-style: italic;
        }

        /* Required field indicator */
        .appointmentForm input:required:invalid {
            border-color: #e74c3c;
        }

        .appointmentForm input:required:valid {
            border-color: #27ae60;
        }

        /* Loading state for button */
        .appointmentForm button[type="submit"].loading {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: not-allowed;
            position: relative;
            color: transparent;
        }

        .appointmentForm button[type="submit"].loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Form Title (if you want to add one) */
        .appointmentForm::before {
            content: "Đặt Lịch Hẹn";
            display: block;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .appointmentForm {
                margin: 20px;
                padding: 20px;
            }
            
            .appointmentForm input[type="text"],
            .appointmentForm input[type="date"],
            .appointmentForm select,
            .appointmentForm textarea {
                padding: 12px 16px;
                font-size: 14px;
            }
            
            .appointmentForm button[type="submit"] {
                padding: 14px 20px;
                font-size: 14px;
            }
        }

        /* Form container background (optional - if you want a full page background) */
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Success/Error Messages */
        .message {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            text-align: center;
        }

        .message.success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .message.error {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        /* Input focus animations */
        .appointmentForm input[type="text"]:focus,
        .appointmentForm input[type="date"]:focus,
        .appointmentForm select:focus,
        .appointmentForm textarea:focus {
            animation: focusGlow 0.3s ease;
        }

        @keyframes focusGlow {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-1px) scale(1.01); }
            100% { transform: translateY(-2px) scale(1); }
        }

        .chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chart-container h3 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .chart-layout {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        #petChart {
            max-width: 300px;
            max-height: 300px;
        }

        .chart-legend {
            flex: 1;
        }

        .chart-legend div {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-size: 16px;
            color: #555;
        }

        .chart-legend span {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 12px;
        }

        @media (max-width: 500px) {
            .chart-layout {
                flex-direction: column;
                gap: 20px;
            }
        }
        .service-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 columns */
            gap: 20px; /* spacing between cards */
            margin-top: 20px;
        }
        .service-card button {
            margin-top: 10px;
            padding: 8px 16px;
            font-size: 14px;
            background-color: #007bff; /* Blue background */
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .service-card button:hover {
            background-color: #0056b3; /* Darker blue on hover */
            transform: scale(1.03);
        }

        .service-card button:active {
            transform: scale(0.98);
        }
        .logout-btn {
            display : block !important; 
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .logout-btn:hover {
            background-color: #c82333;
        }
        .header {
            position: relative;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div style="position: absolute; top: 20px; right: 20px; z-index: 999;">
        <form action="{% url 'logout_view' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="logout-btn">🚪 Đăng xuất</button>
        </form>
    </div>
    <div class="container">
        <div class="header">
            <h1>🐾 Hệ Thống Quản Lý Thú Cưng</h1>
            <p>Chăm sóc thú cưng chuyên nghiệp - Yêu thương trọn vẹn</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('statistics',this)">Tổng quan</button>
            <button class="tab" onclick="showTab('services',this)">Dịch Vụ</button>
            <button class="tab" onclick="showTab('pets',this)">Thông Tin Thú Cưng</button>
            <button class="tab" onclick="showTab('appointments',this)">Lịch Hẹn</button>
        </div>


        <!-- Tab Thống Kê -->
        <div id="statistics" class="tab-content active">
            <h2>Tổng Quan</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalPets">{{ total_pets }}</div>
                    <div class="stat-label">Tổng Thú Cưng</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pending_appointments">{{ pending_appointments }}</div>
                    <div class="stat-label">Yêu cầu đặt lịch</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="monthly_Appointments">{{ monthly_appointments }}</div>
                    <div class="stat-label">Lịch Hẹn Tháng Này</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalRevenue"></div>
                    <div class="stat-label">Doanh Thu (triệu VNĐ)</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>📈 Biểu Đồ Thống Kê Loại Thú Cưng</h3>
                <div class="chart-layout">
                    <canvas id="petChart" width="400" height="300"></canvas>
                    <div class="chart-legend" id="chartLegend"></div>
                </div>
            </div>
            <div>
                <div class="chart-container">
                    <canvas id="revenueChart" width="800" height="400"></canvas>
                </div>
            </div>
        </div>

        <!-- Tab Dịch Vụ -->
        <div id="services" class="tab-content">
            <h2>🏥 Dịch Vụ Chính</h2>
            <div class="service-grid" id="serviceGrid">
                <!-- Dynamic cards will be inserted here -->
            </div>
        </div>


        <!-- Tab Thú Cưng -->
        <div id="pets" class="tab-content">
        <div class="pet-container">
            <div class="pet-header">
                <h2>🐾 Tổng số thú cưng: <span id="totalPets">{{ total_pets }}</span></h2>
            </div>
            <div class="pet-search" style="position: relative; margin-bottom: 16px;">
                <input 
                    type="text" 
                    id="petSearchInput"
                    placeholder="Tìm kiếm theo tên chủ nuôi hoặc tên thú cưng..." 
                    onkeyup="filterPets()" 
                >
                <div class="search-icon"></div>
            </div>

        <div id="petList" class="pet-list">
            {% for pet in pets %}
            <div class="pet-card"
                data-id="{{ pet.id }}"
                data-owner="{{ pet.owner.username }}"
                data-name="{{ pet.name }}"
                data-species="{{ pet.species }}"
                data-breed="{{ pet.breed }}"
                data-gender="{{ pet.gender }}"
                data-age="{{ pet.age }}"
                data-furcolor="{{ pet.fur_color }}"
                data-image="{{ pet.image_url }}"
                data-created="{{ pet.created_at }}"
                data-updated="{{ pet.updated_at }}">

                <img src="{{ pet.image_url }}" alt="{{ pet.name }}" class="pet-image" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">

                <h3 class="pet-title">
                    {{ pet.name }}
                    <span class="species-badge">{{ pet.species }}</span>
                </h3>

                <div class="pet-info">
                    <p><strong>👤 Chủ:</strong> {{ pet.owner.fullname }}</p>
                    <p><strong>🏷️ Giống:</strong> {{ pet.breed }}</p>
                    <p><strong>⚧️ Giới tính:</strong> {{ pet.gender_vi }}</p>
                    <p><strong>🎂 Tuổi:</strong> {{ pet.age }} tuổi</p>
                    <p><strong>🐾 Màu lông:</strong> {{ pet.fur_color }}</p>
                </div>

                <div class="pet-actions">
                    <button class="btn-detail" onclick="showPetDetail(this)">Xem chi tiết</button>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination Controls -->
        <div class="pagination-controls" style="margin-top: 20px; text-align: center;">
            <button onclick="changePetPage(-1)" id="prevPetPage" class="btn" style="background: #6c757d;" disabled>⬅ Trước</button>
            <span id="petPageInfo" style="margin: 0 10px; font-weight: bold;">Trang 1</span>
            <button onclick="changePetPage(1)" id="nextPetPage" class="btn" style="background: #6c757d;">Tiếp ➡</button>
        </div>
    </div>
</div>


        <!-- Modal Detail Pet -->
        <div id="petModal" class="modal" data-pet-id="" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="modalTitle">Thông tin chi tiết</h3>
                    <button class="close" onclick="closeModal()">&times;</button>
                </div>

                <div class="modal-tabs">
                    <button class="tab-button" data-tab="nutrition" onclick="openTab('nutrition')">🍖 Ăn uống</button>
                    <button class="tab-button" data-tab="vaccination" onclick="openTab('vaccination')">💉 Tiêm phòng</button>
                    <button class="tab-button" data-tab="services" onclick="openTab('services')">🛁 Dịch vụ</button>
                    <button class="tab-button" data-tab="medical" onclick="openTab('medical')">🩺 Bệnh án</button>
                </div>

                <div class="modal-body">
                    <div id="tab-nutrition" class="pet-properties active">
                        <p>Đang tải chế độ ăn uống...</p>
                    </div>
                    <div id="tab-vaccination" class="pet-properties">
                        <p>Đang tải lịch sử tiêm phòng...</p>
                    </div>
                    <div id="tab-services" class="pet-properties">
                        <p>Đang tải lịch sử sử dụng dịch vụ...</p>
                    </div>
                    <div id="tab-medical" class="pet-properties">
                        <p>Đang tải lịch sử bệnh án...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Lịch Hẹn -->
        <div id="appointments" class="tab-content">
        <h2>📅 Quản Lý Lịch Hẹn</h2>

        <!-- Switch Button -->
        <div class="form-group" style="margin-bottom: 20px;">
            <button class="btn" onclick="switchListAppointments()" style="background: #17a2b8; margin-bottom: 15px;">
                🔄 Xem danh sách lịch hẹn
            </button>
        </div>

        <form id="appointmentForm" onsubmit="addAppointment(event)" class="appointmentForm">
            {% csrf_token %}

            <!-- Tìm thú cưng theo SĐT chủ nuôi -->
            <label for="ownerPhone">📱 SĐT chủ nuôi:</label>
            <input type="text" id="ownerPhone" name="owner_phone" placeholder="Nhập số điện thoại..." onblur="fetchPetsByPhone()" required><br>

            <!-- Chọn thú cưng -->
            <label for="appointmentPet">🐾 Thú cưng:</label>
            <select id="appointmentPet" name="pet_id" required>
                <option value="">Chọn thú cưng</option>
            </select><br>

            <!-- Dịch vụ -->
            <label for="appointmentService">🛠️ Dịch vụ:</label>
            <select id="appointmentService" name="type" onchange="filterStaffByService()" required>
                <option value="">Chọn dịch vụ</option>
                <option value="HOTEL">Lưu trú</option>
                <option value="BEAUTY">Làm đẹp</option>
                <option value="MEDICAL">Khám chữa bệnh</option>
                <option value="VACCINE">Tiêm phòng</option>
            </select><br>

            <!-- Nhân viên thực hiện -->
            <label for="staff">👩‍⚕️ Người thực hiện:</label>
            <select id="staff" name="staff_id" required>
                <option value="">Chọn nhân viên</option>
            </select><br>

            <!-- Thời gian -->
            <label for="check_in">📅 Check-in:</label>
            <input type="date" id="check_in" name="check_in" required><br>

            <label for="check_out">📅 Check-out:</label>
            <input type="date" id="check_out" name="check_out" required><br>

            <!-- Trạng thái -->
            <label for="status">⏳ Trạng thái:</label>
            <select id="status" name="status" required>
                <option value="PENDING">Chờ xác nhận</option>
                <option value="CONFIRMED">Đã xác nhận</option>
            </select><br>

            <!-- Ghi chú -->
            <label for="notes">📝 Ghi chú:</label>
            <textarea id="notes" name="notes" placeholder="Thông tin bổ sung nếu có..."></textarea><br>

            <button type="submit" style="background: #28a745; color: white;">Đặt lịch hẹn</button>
        </form>
    </div>


        <div id="newAppointmentWindow" class="tab-content">
            <h2>📊 Danh sách lịch hẹn</h2>
            
            <!-- Switch Back Button -->
            <div class="form-group" style="margin-bottom: 20px;">
                <button class="btn" onclick="switchBooking()" style="background: #dc3545; margin-bottom: 15px;">
                    ↩️ Chế độ đăng kí
                </button>
            </div>
            
            <!-- Search and Controls -->
            <div class="pagination-controls">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="🔍 Tìm kiếm theo tên thú cưng, chủ..." oninput="searchAppointments()">
                    <div class="filter-box">
                        <select
                            id="statusFilter"
                            class="form-select"
                            onchange="filterByAppointmentStatus()"
                        >
                            <option value="">-- Tất cả trạng thái --</option>
                            <option value="confirmed">✅ Đã duyệt</option>
                            <option value="pending">⏳ Chưa duyệt</option>
                            <option value="completed">✔️ Hoàn tất</option>
                            <option value="cancelled">❌ Đã hủy</option>
                        </select>
                    </div>
                </div>
 
                <div class="items-per-page">
                    <label>Hiển thị:</label>
                    <select id="itemsPerPage" onchange="changeItemsPerPage()">
                        <option value="5">5</option>
                        <option value="10" selected>10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                    </select>
                    <span>mục/trang</span>
                </div>
            </div>
            
            <!-- New Window Content -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border: 2px dashed #6c757d;">
                <h3>Danh sách lịch hẹn</h3>
                
                <div class="list-appointments" id="list-appointments">
                    <!-- Appointments will be displayed here -->
                </div>
                
                <!-- Pagination Info -->
                <div class="pagination-info" id="paginationInfo">
                    <!-- Pagination info will be displayed here -->
                </div>
                
                <!-- Pagination Controls -->
                <div class="pagination" id="paginationControls">
                    <!-- Pagination buttons will be displayed here -->
                </div>
            </div>
        </div>
</div>
        </div>
    </div>
</div>
    </div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
        let sampleAppointments = [
            {% for appointment in appointments %}
            {
                id: "{{ appointment.id }}",
                pet: { name: "{{ appointment.pet.name|escapejs }}" },
                owner: { fullname: "{{ appointment.owner.fullname|escapejs }}" },
                type: "{{ appointment.type|escapejs }}",
                check_in: "{{ appointment.check_in }}",
                check_out: "{{ appointment.check_out }}",
                staff: { fullname: "{{ appointment.staff.fullname|default:'NULL'|escapejs }}" },
                status: "{{ appointment.status|escapejs }}",
                approver: { fullname: "{{ appointment.approver.fullname|default:'NULL'|escapejs }}" },
                notes: "{{ appointment.notes|default:'NULL'|escapejs }}",
                created_at: "{{ appointment.created_at }}",
                updated_at: "{{ appointment.updated_at }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];
            
        
        let currentPage = 1;
        let itemsPerPage = 10;
        let filteredAppointments = [...sampleAppointments];
        let searchTerm = '';
        let currentAppointments = [];
        
        function getCsrfToken() {
            const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith('csrftoken='))
                ?.split('=')[1];
            
            if (cookieValue)
                return cookieValue;
            
            const metaTag = document.querySelector('meta[name="csrf-token"]');
            if (metaTag)
                return metaTag.getAttribute('content');
            
            const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
            if (csrfInput)
                return csrfInput.value;
            
            console.warn('Không tìm thấy CSRF token!');
            return '';
        }

        function getStatusClass(status) {
            const statusMap = {
                'pending': 'pending',
                'confirmed': 'confirmed',
                'completed': 'completed',
                'cancelled': 'cancelled'
            };
            return statusMap[status] || 'pending';
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'Chờ xử lý',
                'confirmed': 'Đã xác nhận',
                'completed': 'Hoàn thành',
                'cancelled': 'Đã hủy'
            };
            return statusMap[status] || status;
        }

        function renderAppointments() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            currentAppointments = filteredAppointments.slice(startIndex, endIndex);
            
            const listContainer = document.getElementById('list-appointments');
            
            if (currentAppointments.length === 0) {
                listContainer.innerHTML = '<p style="padding: 15px; background: #fff3cd; border-radius: 5px; color: #856404;">📭 Không tìm thấy lịch hẹn nào.</p>';
                return;
            }
            
            listContainer.innerHTML = currentAppointments.map(appointment => ` 
                <div class="appointment" 
                    ap-id="${appointment.id}" 
                    ap-pet="${appointment.pet.name}" 
                    ap-owner="${appointment.owner.fullname}" 
                    ap-type="${appointment.type}" 
                    ap-check_in="${appointment.check_in}" 
                    ap-check_out="${appointment.check_out || ''}" 
                    ap-staff="${appointment.staff?.fullname || ''}" 
                    ap-status="${appointment.status}" 
                    ap-approver="${appointment.approver?.fullname || ''}" 
                    ap-notes="${appointment.notes || ''}" 
                    ap-created_at="${appointment.created_at}" 
                    ap-updated_at="${appointment.updated_at}"> 
                 
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"> 
                        <strong style="color: #495057; font-size: 16px;">🐾 ${appointment.pet.name} - ${appointment.owner.fullname}</strong> 
                        <span class="status ${getStatusClass(appointment.status)}"> 
                            ${getStatusText(appointment.status)} 
                        </span> 
                    </div> 
                     
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;"> 
                        <div><strong>🏥 Dịch vụ:</strong> ${appointment.type}</div> 
                        <div><strong>👨‍⚕️ Nhân viên:</strong> ${appointment.staff?.fullname || 'Chưa phân công'}</div> 
                        <div><strong>📅 Check-in:</strong> ${appointment.check_in}</div> 
                        <div><strong>📅 Check-out:</strong> ${appointment.check_out || 'Chưa xác định'}</div> 
                    </div> 
                     
                    ${appointment.notes ? `<div style="margin-top: 10px; padding: 8px; background: #f8f9fa; border-radius: 4px; font-style: italic;">📝 ${appointment.notes}</div>` : ''} 
                    
                    ${appointment.status === 'pending' ? `
                        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" class="btn-approve" onclick="approveAppointment('${appointment.id}')" 
                                    style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">
                                ✅ Chấp nhận
                            </button>
                            <button type="button" class="btn-reject" onclick="rejectAppointment('${appointment.id}')" 
                                    style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">
                                ❌ Từ chối
                            </button>
                        </div>
                    ` : ''}
                     
                    <div style="margin-top: 10px; font-size: 12px; color: #6c757d;"> 
                        Tạo: ${appointment.created_at} | Cập nhật: ${appointment.updated_at} 
                    </div> 
                </div> 
            `).join('');
        }

        function renderPaginationInfo() {
            const startIndex = (currentPage - 1) * itemsPerPage + 1;
            const endIndex = Math.min(currentPage * itemsPerPage, filteredAppointments.length);
            const total = filteredAppointments.length;
            
            document.getElementById('paginationInfo').innerHTML = 
                `Hiển thị ${startIndex}-${endIndex} của ${total} lịch hẹn`;
        }

        function renderPaginationControls() {
            const totalPages = Math.ceil(filteredAppointments.length / itemsPerPage);
            const paginationContainer = document.getElementById('paginationControls');
            
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <button onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    ← Trước
                </button>
            `;
            
            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            if (startPage > 1) {
                paginationHTML += `<button onclick="goToPage(1)">1</button>`;
                if (startPage > 2) {
                    paginationHTML += `<button disabled>...</button>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button onclick="goToPage(${i})" ${i === currentPage ? 'class="active"' : ''}>
                        ${i}
                    </button>
                `;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<button disabled>...</button>`;
                }
                paginationHTML += `<button onclick="goToPage(${totalPages})">${totalPages}</button>`;
            }
            
            // Next button
            paginationHTML += `
                <button onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    Sau →
                </button>
            `;
            
            paginationContainer.innerHTML = paginationHTML;
        }

        function goToPage(page) {
            const totalPages = Math.ceil(filteredAppointments.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderAppointments();
                renderPaginationInfo();
                renderPaginationControls();
            }
        }

        function changeItemsPerPage() {
            itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
            currentPage = 1;
            renderAppointments();
            renderPaginationInfo();
            renderPaginationControls();
        }

        function searchAppointments() {
            searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            filteredAppointments = sampleAppointments.filter(appointment => {
                return appointment.pet.name.toLowerCase().includes(searchTerm) ||
                       appointment.owner.fullname.toLowerCase().includes(searchTerm) ||
                       appointment.type.toLowerCase().includes(searchTerm) ||
                       (appointment.staff?.fullname || '').toLowerCase().includes(searchTerm);
            });
            
            currentPage = 1;
            renderAppointments();
            renderPaginationInfo();
            renderPaginationControls();
        }

        function switchBooking() {
            alert('Chuyển về chế độ đăng ký!');
            // Add your switching logic here
        }

        document.addEventListener('DOMContentLoaded', function() {
            renderAppointments();
            renderPaginationInfo();
            renderPaginationControls();
        });
        
        function showTab(tabId, buttonElement) {
            // 1. Ẩn tất cả nội dung
            const contents = document.querySelectorAll('.tab-content');
            
            contents.forEach(content => {
                content.style.display = 'none';
            });

            // 2. Ẩn class 'active' từ tất cả nút
            const tabButtons = document.querySelectorAll('.tabs .tab');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });

            // 3. Hiện tab tương ứng
            const tabContent = document.getElementById(tabId);
            if (tabContent) {
                tabContent.style.display = 'block';
            }

            // 4. Gán 'active' cho đúng nút
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
        }

        function openTab(tabName) {
            const contents = document.querySelectorAll('.pet-properties');
            contents.forEach(c => c.classList.remove('active'));

            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(b => b.classList.remove('active'));

            document.getElementById(`tab-${tabName}`).classList.add('active');
            const activeBtn = document.querySelector(`.tab-button[data-tab="${tabName}"]`);
            if (activeBtn) activeBtn.classList.add('active');

            const petId = document.getElementById('petModal').dataset.petId;
            if (!petId) {
                console.error("❌ petId không hợp lệ!");
                return;
            }
            if (tabName === "nutrition") {
                fetch(`/nutrition/${petId}/`)
                    .then(res => res.json())
                    .then(data => {
                        const container = document.getElementById('tab-nutrition');
                        container.innerHTML = "";
                        console.log(petId)

                        if (data.nutrition_plans.length === 0) {
                            container.innerHTML = "<p>Không có dữ liệu về chế độ dinh dưỡng.</p>";
                            
                        }
                        else {
                            data.nutrition_plans.forEach(plan => {
                                const item = document.createElement('div');
                                item.className = "nutrition-item";
                                item.innerHTML = `
                                    <p><strong>🍱 Loại thức ăn:</strong> ${plan.food_type}</p>
                                    <p><strong>🥣 Khẩu phần:</strong> ${plan.portion}</p>
                                    <p><strong>📝 Ghi chú:</strong> ${plan.note || "Không có"}</p>
                                    <p><strong>👤 Người tạo:</strong> ${plan.created_by}</p>
                                    <p><strong>🕒 Cập nhật:</strong> ${new Date(plan.updated_at).toLocaleDateString('vi-VN')}</p>
                                    <hr>
                                `;
                                container.appendChild(item);
                            });
                        }
                    })
                    .catch(err => {
                        console.error("Lỗi khi tải chế độ ăn:", err);
                        document.getElementById('tab-nutrition').innerHTML = "<p>Đã xảy ra lỗi khi tải dữ liệu.</p>";
                    });
            }

            if (tabName === "vaccination") {
                fetch(`/vaccinations/${petId}/`)
                .then(res => res.json())
                .then(data => {
                    const container = document.getElementById('tab-vaccination');
                    container.innerHTML = "";

                    if (data.length === 0) {
                        container.innerHTML = '<p>Chưa có dữ liệu tiêm phòng.</p>';
                    }
                    else{
                        data.forEach(v => {
                            const item = document.createElement('div');
                            item.className = "vaccination-item";
                            item.innerHTML = `
                                <h5>${v.vaccine_name}</h5>
                                <p>📅 Ngày tiêm: ${new Date(v.vaccination_date).toLocaleDateString('vi-VN')}</p>
                                <p>⏭️ Hẹn tiếp theo: ${new Date(v.next_due).toLocaleDateString('vi-VN')}</p>
                                <p>💉 Số liều: ${v.total_doses}</p>
                                <p>🧪 Số lô: ${v.batch_number}</p>
                                <p>✅ Hoàn tất: ${v.is_completed ? 'Có' : 'Chưa'}</p>
                                ${v.note ? `<p>📝 Ghi chú: ${v.note}</p>` : ''}
                            `;
                            container.appendChild(item);
                        });
                    }
                })
                .catch(err => {
                        console.error("Lỗi khi tải chế độ ăn:", err);
                        document.getElementById('tab-vaccination').innerHTML = "<p>Đã xảy ra lỗi khi tải dữ liệu.</p>";
                });
            }

            if (tabName === "services") {
                fetch(`/services/${petId}/`)
                    .then(res => res.json())
                    .then(data => {
                        const container = document.getElementById('tab-services');
                        container.innerHTML = "";

                        if (data.length === 0) {
                            container.innerHTML = '<p>Chưa có dữ liệu về lịch sử sử dụng dịch vụ.</p>';
                        }
                        else {
                            data.forEach(service => {
                                const checkIn = new Date(service.check_in).toLocaleDateString('vi-VN');
                                const checkOut = new Date(service.check_out).toLocaleDateString('vi-VN');

                                let content = `
                                    <div class="service-item p-3 mb-3 border rounded">
                                        <h5>${service.type === "beauty" ? "💅 Dịch vụ làm đẹp" : "🏨 Dịch vụ lưu trú"}</h5>
                                        <p>📆 Ngày nhận: ${checkIn}</p>
                                        <p>📤 Ngày trả: ${checkOut}</p>
                                `;

                                if (service.type === "beauty") {
                                    content += `
                                        <p>🧴 Loại dịch vụ: ${service.service_type}</p>
                                        ${service.notes ? `<p>📝 Ghi chú: ${service.notes}</p>` : ""}
                                    `;
                                } else if (service.type === "hotel") {
                                    content += `
                                        <p>🏠 Loại phòng: ${service.room_type}</p>
                                        <p>🔢 Số phòng: ${service.room_number}</p>
                                        ${service.special_needs ? `<p>📝 Yêu cầu đặc biệt: ${service.special_needs}</p>` : ""}
                                    `;
                                }
                                content += `</div>`;
                                container.innerHTML += content;
                            });
                        }
                    })
                    .catch(err => {
                        console.error("Lỗi khi tải lịch sử dịch vụ:", err);
                        document.getElementById('tab-services').innerHTML = "<p>Đã xảy ra lỗi khi tải dữ liệu.</p>";
                    });
            }
            
            if (tabName === "medical") {
                fetch(`/medical/${petId}/`)
                .then(res => res.json())
                .then(data => {
                    const container = document.getElementById('tab-medical');
                    container.innerHTML = "";

                    if (data.length === 0) {
                        container.innerHTML = "<p>Chưa có dữ liệu khám bệnh.</p>";
                    } else {
                        data.forEach(record => {
                            const item = document.createElement('div');
                            item.className = "medical-item";
                            item.innerHTML = `
                                <p><strong>🩺 Chẩn đoán:</strong> ${record.diagnosis}</p>
                                <p><strong>💊 Điều trị:</strong> ${record.treatment}</p>
                                ${record.notes ? `<p><strong>📝 Ghi chú:</strong> ${record.notes}</p>` : ''}
                                <p><strong>📅 Ngày nhận:</strong> ${new Date(record.check_in).toLocaleDateString('vi-VN')}</p>
                                <p><strong>📤 Ngày trả:</strong> ${new Date(record.check_out).toLocaleDateString('vi-VN')}</p>
                            `;
                            container.appendChild(item);
                        });
                    }
                })
                .catch(err => {
                    console.error("Lỗi khi tải lịch sử khám bệnh:", err);
                    document.getElementById('tab-medical').innerHTML = "<p>Đã xảy ra lỗi khi tải dữ liệu.</p>";
                });
            }
        }

        function showPetDetail(button) {
            const card = button.closest('.pet-card');
            const petId = card?.dataset.id;

            if (!petId) {
                console.error("❌ Không tìm thấy petId từ thẻ cha .pet-card");
                return;
            }

            const modal = document.getElementById('petModal');
            modal.dataset.petId = petId;
            modal.style.display = 'block';

            const nutritionTab = document.getElementById('tab-nutrition');
            if (nutritionTab) {
                nutritionTab.innerHTML = '<p>Đang tải dữ liệu...</p>';
            }
            
            openTab('nutrition');
        }

        function closeModal() {
            const modal = document.getElementById('petModal');
            modal.style.display = 'none';
            modal.dataset.petId = '';

            // Just hide tabs & remove active states, but keep the data
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('tab-content').style.removeProperty('display');
        }

        function filterPets() {
            const input = document.getElementById("petSearchInput");
            const filter = input.value.toLowerCase();
            const cards = document.querySelectorAll(".pet-card");

            cards.forEach(card => {
                const name = card.getAttribute("data-name").toLowerCase();
                const breed = card.getAttribute("data-breed").toLowerCase();
                const owner = card.getAttribute("data-owner").toLowerCase();

                if (name.includes(filter) || breed.includes(filter) || owner.includes(filter)) {
                    card.style.display = "";
                } else {
                    card.style.display = "none";
                }
            });
        }
        
        function switchListAppointments() {
            // Hide the original appointments tab
            const originalTab = document.getElementById('appointments');
            const newWindow = document.getElementById('newAppointmentWindow');
            originalTab.style.display = 'none';
            newWindow.style.display = 'block';
    
            // Load appointments list
            // loadAppointmentsList();

            console.log('Switched to appointments list view');
        }

        function switchBooking() {
            // Show the original appointments tab, hide new window
            const originalTab = document.getElementById('appointments');
            const newWindow = document.getElementById('newAppointmentWindow');
            
            originalTab.style.display = 'block';
            newWindow.style.display = 'none';
            
            console.log('Switched back to original view');
        }

        function getStatusColor(status) {
            switch(status) {
                case 'Hoàn thành': return '#28a745';
                case 'Đang thực hiện': return '#ffc107';
                case 'Đã đặt': return '#17a2b8';
                case 'Đã hủy': return '#dc3545';
                default: return '#6c757d';
            }
        }
    
        let petsPerPage = 6;
        let currentPetPage = 1;
        let allPetCards = [];

        document.addEventListener("DOMContentLoaded", () => {
            allPetCards = Array.from(document.querySelectorAll("#petList .pet-card"));
            paginatePets();
        });

        function paginatePets() {
            const start = (currentPetPage - 1) * petsPerPage;
            const end = start + petsPerPage;

            allPetCards.forEach((card, index) => {
                card.style.display = (index >= start && index < end) ? "" : "none";
            });

            const totalPages = Math.ceil(allPetCards.length / petsPerPage);
            document.getElementById("petPageInfo").textContent = `Trang ${currentPetPage} / ${totalPages}`;
            document.getElementById("prevPetPage").disabled = currentPetPage === 1;
            document.getElementById("nextPetPage").disabled = currentPetPage === totalPages;
        }

        function changePetPage(offset) {
            const totalPages = Math.ceil(allPetCards.length / petsPerPage);
            currentPetPage = Math.min(Math.max(1, currentPetPage + offset), totalPages);
            paginatePets();
        }

        function sendAppointmentStatusUpdate(appointmentId, newStatus, reason = null) {
            fetch(`/appointment/${appointmentId}/update/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken(),
                },
                body: JSON.stringify({
                    status: newStatus,
                    reason: reason
                }),
            })
            .then(response => {
                if (response.ok) {
                    alert('Cập nhật trạng thái thành công!');
                    
                } else {
                    alert('Cập nhật trạng thái thất bại.');
                }
            })
            .catch(error => {
                console.error('Lỗi:', error);
            });
        }

        function approveAppointment(appointmentId) {
            if (confirm('Bạn có chắc chắn muốn chấp nhận lịch hẹn này?')) {
                updateAppointmentStatus(appointmentId, 'confirmed');
                sendAppointmentStatusUpdate(appointmentId, 'confirmed');

            }
        }

        function rejectAppointment(appointmentId) {
            const reason = prompt('Vui lòng nhập lý do từ chối lịch hẹn:');
            if (reason !== null && reason.trim() !== '') {
                updateAppointmentStatus(appointmentId, 'cancelled', reason);
                sendAppointmentStatusUpdate(appointmentId, 'cancelled', reason);

            } else if (reason !== null) {
                alert('Vui lòng nhập lý do từ chối!');
            }
        }

        function getCSRFToken() {
            let cookieValue = null;
            const name = 'csrftoken';
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    cookie = cookie.trim();
                    if (cookie.startsWith(name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function updateAppointmentStatus(appointmentId, newStatus) {
            event.preventDefault()
            const appointmentElement = document.querySelector(`[ap-id="${appointmentId}"]`);
            if (appointmentElement) {
                // Update the status attribute
                appointmentElement.setAttribute('ap-status', newStatus);
                
                // Update the status display
                const statusElement = appointmentElement.querySelector('.status');
                if (statusElement) {
                    statusElement.className = `status ${getStatusClass(newStatus)}`;
                    statusElement.textContent = getStatusText(newStatus);
                    
                    // Set background color based on status
                    if (newStatus == 'cancelled') {
                        console.log(newStatus)
                        statusElement.style.backgroundColor = '#dc3545'; // Red background
                        statusElement.style.color = 'white';
                    } else {
                        console.log(newStatus)
                        statusElement.style.backgroundColor = '#28a745'; // Green background
                        statusElement.style.color = 'white';
                    }
                }
                
                // Remove the action buttons
                const buttonsContainer = appointmentElement.querySelector('.btn-approve, .btn-reject')?.parentElement;
                if (buttonsContainer) {
                    buttonsContainer.remove();
                }
            }
        }
        function fetchPetsByPhone() {
            const phone = document.getElementById('ownerPhone').value;
            if (!phone) return;

            fetch(`/api/get-pets/?phone=${phone}`)
                .then(response => response.json())
                .then(data => {
                    const petSelect = document.getElementById('appointmentPet');
                    petSelect.innerHTML = '<option value="">Chọn thú cưng</option>';

                    data.pets.forEach(pet => {
                        const option = document.createElement('option');
                        option.value = pet.id;
                        option.textContent = pet.name;
                        petSelect.appendChild(option);
                    });

                    if (data.pets.length === 0) {
                        alert("Không tìm thấy thú cưng cho số điện thoại này.");
                    }
                })
                .catch(err => {
                    console.error('Lỗi khi lấy danh sách thú cưng:', err);
                });
        }
        function filterStaffByService() {
            const service = document.getElementById('appointmentService').value;
            const staffSelect = document.getElementById('staff');

            let role = null;
            if (service === 'HOTEL' || service === 'BEAUTY') {
                role = 'Staff';
            } else if (service === 'MEDICAL' || service === 'VACCINE') {
                role = 'Vet';
            }

            // Clear previous options
            staffSelect.innerHTML = '<option value="">Chọn nhân viên</option>';

            if (!role) return; // If no service or invalid, exit

            fetch(`/api/get-users/?role=${role}`)
                .then(response => response.json())
                .then(data => {
                    data.users.forEach(user => {
                        const option = document.createElement('option');
                        option.value = user.id;
                        option.textContent = user.fullname;
                        staffSelect.appendChild(option);
                    });
                })
                .catch(err => {
                    console.error('Lỗi khi lấy nhân viên:', err);
                });
        }
        function addAppointment(event) {
            event.preventDefault(); // 🚫 Stop form from reloading page

            const data = {
                owner_phone: document.getElementById('ownerPhone').value,
                pet_id: document.getElementById('appointmentPet').value,
                type: document.getElementById('appointmentService').value,
                staff_id: document.getElementById('staff').value,
                check_in: document.getElementById('check_in').value,
                check_out: document.getElementById('check_out').value,
                status: document.getElementById('status').value.toLowerCase(),
                notes: document.getElementById('notes').value
            };

            // 👤 If status is "pending", do not send staff_id
            if (data.status === 'pending') {
                delete data.staff_id;
            }

            fetch('/api/create-appointment/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken(),
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => {
                        throw new Error(data.error || 'Không thể đặt lịch.');
                    });
                }
                return response.json();
            })
            .then(newAppointment => {
                alert('🎉 Đặt lịch thành công!');

                // ✅ Add to top of currentAppointments
                currentAppointments.unshift(newAppointment);

                // ✅ Reset the form
                document.getElementById('appointmentForm').reset();
            })
            .catch(error => {
                console.error('Lỗi:', error);
                alert('❌ Lỗi: ' + error.message);
            });
        }
        function filterByAppointmentStatus() {
            const selectedStatus = document.getElementById("statusFilter").value;

            if (selectedStatus === "") {
                // Show all if no filter selected
                filteredAppointments = [...sampleAppointments];
            } else {
                // Filter by selected status
                filteredAppointments = sampleAppointments.filter(app => app.status === selectedStatus);
            }

            currentPage = 1; // Reset to first page after filtering
            renderAppointments();
        }



        function drawPetChart() {
            fetch('/api/pet-species-stats/')
                .then(response => response.json())
                .then(stats => {
                    const labels = Object.keys(stats);
                    const data = Object.values(stats);

                    const ctx = document.getElementById("petChart").getContext("2d");

                    const backgroundColors = [
                        '#FF6384', // Pink
                        '#36A2EB', // Blue
                        '#FFCE56', // Yellow
                        '#4BC0C0', // Teal
                        '#9966FF', // Purple
                        '#FF9F40', // Orange
                        '#66CDAA', // Medium Aquamarine
                        '#D2691E', // Chocolate
                        '#8BC34A', // Light Green
                        '#E91E63'  // Deep Pink
                    ];

                    const petChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Số lượng',
                                data: data,
                                backgroundColor: backgroundColors.slice(0, labels.length),
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });

                    // Create custom legend
                    const legendContainer = document.getElementById("chartLegend");
                    legendContainer.innerHTML = labels.map((label, i) => `
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <span style="display: inline-block; width: 20px; height: 20px; background-color: ${backgroundColors[i]}; border-radius: 4px; margin-right: 10px;"></span>
                            ${label}
                        </div>
                    `).join('');
                })
                .catch(error => {
                    console.error('Error fetching pet stats:', error);
                });
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetch('/api/services/')
                .then(response => response.json())
                .then(data => {
                    const grid = document.getElementById('serviceGrid');
                    grid.innerHTML = '';

                    data.services.forEach(service => {
                        const id = service.type.toLowerCase();
                        const formattedPrice = service.price.toLocaleString('vi-VN') + ' VNĐ';

                        grid.innerHTML += `
                            <div class="service-card" id="${id}">
                                <h3>${getIcon(service.type)} ${service.type}</h3>
                                <p>${service.description}</p>
                                <p>⏰ Thời gian: ${service.duration}</p>
                                <div class="price">
                                    <span id="${id}-price">${formattedPrice}</span>
                                    <input type="text" 
                                            id="${id}-input" 
                                            value="${formattedPrice}" 
                                            style="display:none;" 
                                            onblur="handlePriceUpdate('${id}')" 
                                            onkeydown="checkEnter(event, '${id}')">
                                    </div>
                                <button onclick="toggleEdit('${id}')">✏️ Sửa giá</button>
                            </div>
                        `;
                    });
                });
        });

        function getIcon(type) {
            const lower = type.toLowerCase();
            if (lower.includes('khám')) return '🩺';
            if (lower.includes('tiêm')) return '💉';
            if (lower.includes('làm') || lower.includes('đẹp')) return '✂️';
            if (lower.includes('lưu')) return '🏠';
            return '🔧';
        }

        function toggleEdit(serviceId) {
            const input = document.getElementById(`${serviceId}-input`);
            const span = document.getElementById(`${serviceId}-price`);
            input.style.display = 'inline';
            span.style.display = 'none';
            input.focus();
        }
    
        function handlePriceUpdate(serviceId) {
            const input = document.getElementById(`${serviceId}-input`);
            const newText = input.value;
            const numberPrice = parseInt(newText.replace(/[^\d]/g, ''));

            if (isNaN(numberPrice)) {
                alert('❌ Giá không hợp lệ!');
                return;
            }

            fetch('/api/update-service-price/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify({
                    type: serviceId,
                    price: numberPrice
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const priceSpan = document.getElementById(`${serviceId}-price`);
                    const formatted = numberPrice.toLocaleString('vi-VN') + ' VNĐ';
                    priceSpan.textContent = formatted;
                    input.value = formatted;
                    input.style.display = 'none';
                    priceSpan.style.display = 'inline';
                } else {
                    alert('❌ ' + data.error);
                }
            })
            .catch(error => {
                console.error(error);
                alert('❌ Lỗi mạng');
            });
        }
        function checkEnter(event, serviceId) {
            if (event.key === 'Enter') {
                event.target.blur(); // trigger blur to run update
            }
        }

        // Gọi hàm sau khi trang tải xong
        window.onload = drawPetChart;

        
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/api/monthly-revenue/')
                .then(response => response.json())
                .then(data => {
                    const total = data.total_revenue || 0;
                    // Convert to triệu VND (million VND)
                    const millions = (total / 1_000_000);
                    document.getElementById('totalRevenue').textContent = millions;
                })
                .catch(error => {
                    console.error('Lỗi khi lấy doanh thu:', error);
                    document.getElementById('totalRevenue').textContent = '0';
                });
        });

        document.addEventListener('DOMContentLoaded', () => {
            fetch('/api/monthly-revenue-chart/')
                .then(response => response.json())
                .then(data => {
                    const revenues = data.monthly_revenue;
                    const ctx = document.getElementById('revenueChart').getContext('2d');

                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6',
                                    'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
                            datasets: [{
                                label: 'Doanh thu (VND)',
                                data: revenues,
                                backgroundColor: '#4CAF50'
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: '📊 Doanh thu theo tháng trong năm'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return value.toLocaleString('vi-VN') + ' ₫';
                                        }
                                    }
                                }
                            }
                        }
                    });
                });
        });
        
</script>
</body>
</html>