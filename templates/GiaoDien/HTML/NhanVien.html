<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Nhân Viên - PetCare</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
       :root {
    --primary: #4f46e5;
    --secondary: #64748b;
    --success: #22c55e;
    --danger: #ef4444;
    --warning: #f59e0b;
    --white: #fff;
    --sidebar-bg: #fff;
    --sidebar-title-bg: #eef2ff;
    --sidebar-title-color: #4f46e5;
    --background: #f7fafd;
    --input-bg: #f7f8fa;
    --modal-overlay: rgba(32,38,59,0.12);
}

html, body {
    height: 100%;
}

body {
    font-family: 'Inter', sans-serif;
    background: var(--background);
    margin: 0;
    padding: 0;
    min-height: 100vh;
    box-sizing: border-box;
}

/* SIDEBAR */
.sidebar {
    width: 260px;
    background: var(--sidebar-bg);
    height: 100vh;
    position: fixed;
    top: 0; left: 0;
    box-shadow: 2px 0 16px rgba(0,0,0,0.07);
    display: flex;
    flex-direction: column;
    z-index: 3;
}

.sidebar-title {
    background: var(--sidebar-title-bg);
    color: var(--sidebar-title-color);
    font-weight: 700;
    font-size: 20px;
    padding: 22px 0 12px 0;
    text-align: center;
    letter-spacing: 2px;
    border-radius: 0 0 12px 12px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.sidebar-title i { font-size: 19px; }

.menu-item {
    display: flex;
    align-items: center;
    padding: 13px 20px;
    margin: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
    color: var(--secondary);
    font-weight: 500;
    font-size: 15px;
    transition: .16s;
    gap: 12px;
}

.menu-item:hover, .menu-item.active {
    background: var(--primary);
    color: #fff;
}

.menu-item i { min-width: 20px; font-size: 17px; }

.content {
    margin-left: 260px;
    padding: 38px 36px 28px 36px;
    min-height: 100vh;
    transition: .2s;
}

/* PANEL & TABLE */
.panel {
    display: none;
    background: #fff;
    border-radius: 15px;
    padding: 34px 34px 32px 34px;
    margin-bottom: 34px;
    box-shadow: 0 8px 40px rgba(80,96,160,0.10);
    animation: fadeIn .4s;
}

.panel.active { display: block; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(25px);}
    to   { opacity: 1; transform: none;}
}

h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 20px;
    letter-spacing: 1px;
}

.search-bar {
    display: flex;
    gap: 10px;
    margin-bottom: 18px;
    align-items: center;
}

.search-input {
    flex: 1;
    padding: 10px 14px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    font-size: 15px;
    background: var(--input-bg);
    transition: .13s;
}

.btn {
    padding: 8px 18px;
    border-radius: 6px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    font-size: 15px;
    transition: .14s;
    outline: none;
}

.btn-primary { background: var(--primary); color: #fff; }
.btn-success { background: var(--success); color: #fff; }
.btn-danger { background: var(--danger); color: #fff; }
.btn-warning { background: var(--warning); color: #fff; }
.btn:hover, .btn:focus { opacity: .92; }
.btn + .btn { margin-left: 7px; }

.table-container { overflow-x: auto; }

table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    margin-bottom: 10px;
    border-radius: 10px;
    overflow: hidden;
    font-size: 15px;
}

th, td {
    padding: 13px 12px;
    text-align: left;
    border-bottom: 1px solid #f2f2f2;
    vertical-align: middle;
}

th {
    background: #f4f7fe;
    font-weight: 600;
    color: #222;
}

tr:hover { background: #f7f7fd; }

.status {
    padding: 4px 16px;
    border-radius: 999px;
    font-size: 13px;
    font-weight: 500;
    display: inline-block;
}

.status-pending    { background: #fef3c7; color: #d97706; }
.status-confirmed  { background: #dcfce7; color: #15803d; }
.status-cancelled  { background: #fee2e2; color: #b91c1c; }

/* MODAL POPUP */
.modal-overlay {
    display: none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: var(--modal-overlay);
    z-index: 100;
    align-items: center;
    justify-content: center;
}
.modal-overlay.active { display: flex; }

.modal {
    background: #fff;
    border-radius: 18px;
    box-shadow: 0 8px 40px rgba(80,96,160,0.14);
    padding: 38px 32px 28px 32px;
    min-width: 340px;
    max-width: 96vw;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    animation: fadeIn .23s;
}

.modal-title {
    color: #4f46e5;
    font-size: 22px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 18px;
    letter-spacing: 1px;
}

.modal .modal-close {
    position: absolute;
    top: 16px; right: 20px;
    background: none;
    border: none;
    font-size: 22px;
    color: #999;
    cursor: pointer;
    transition: .16s;
}
.modal .modal-close:hover { color: #ef4444; }

.modal .modal-footer {
    width: 100%;
    display: flex;
    justify-content: center;
    gap: 18px;
    margin-top: 28px;
}

.modal .btn { min-width: 80px; font-size: 16px; font-weight: 600; padding: 10px 0; }
.modal .btn-danger { background: #ef4444; color: #fff; }
.modal .btn-primary { background: #4f46e5; color: #fff; }

/* FORM TRONG MODAL */
.modal form {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-top: 12px;
    align-items: stretch;
}
.modal .form-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.modal .form-label {
    font-weight: 600;
    color: #444;
    margin-bottom: 2px;
    font-size: 15px;
}
.modal .form-input,
.modal .form-select {
    padding: 10px 12px;
    border: 1px solid #e5e7eb;
    border-radius: 7px;
    font-size: 15px;
    background: #f8fafc;
    transition: border .18s;
}
.modal .form-input:focus,
.modal .form-select:focus {
    border-color: #4f46e5;
    background: #fff;
    outline: none;
}
.modal .modal-footer {
    width: 100%;
    display: flex;
    justify-content: center;
    margin-top: 12px;
}
.modal .btn-success[type="submit"] {
    width: 110px;
    padding: 10px 0;
    font-size: 16px;
    font-weight: 600;
    background: #22c55e;
    color: #fff;
    border: none;
    border-radius: 7px;
    transition: background .15s;
}
.modal .btn-success[type="submit"]:hover {
    background: #16a34a;
}

/* TOAST */
.toast {
    position: fixed;
    left: 50%; top: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    color: var(--primary);
    font-weight: 600;
    font-size: 16px;
    padding: 20px 40px;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 12px;
}
.toast.active {
    opacity: 1;
    pointer-events: auto;
    animation: toastIn 0.5s ease;
}
@keyframes toastIn {
    from { opacity: 0; transform: translate(-50%, -40%);}
    to   { opacity: 1; transform: translate(-50%, -50%);}
}

/* CALENDAR */
.calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
    margin: 20px 0;
    padding: 16px;
    background: #f8fafc;
    border-radius: 12px;
}
.calendar-header {
    text-align: center;
    padding: 8px;
    font-weight: 600;
    color: #64748b;
}
.calendar-day {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s;
    position: relative;
}
.calendar-day:hover {
    background: #e0e7ff;
    color: var(--primary);
    border-color: var(--primary);
}
.calendar-day.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}
.calendar-day.has-appointment {
    background: #e0e7ff;
    color: var(--primary);
    font-weight: 600;
}
.day-appointments {
    position: absolute;
    top: 100%; left: 0; right: 0;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    padding: 12px;
    z-index: 10;
    min-width: 300px;
}
.day-appointment-item {
    padding: 8px;
    border-bottom: 1px solid #e5e7eb;
}
.day-appointment-item:last-child { border: none; }

/* MOBILE RESPONSIVE */
@media (max-width: 700px) {
    .modal { min-width: 220px; padding: 18px 7vw; }
    .content { padding: 16px 5vw; }
}
.btn-sm {
    padding: 3px 12px;
    font-size: 13px;
    border-radius: 5px;
    margin-top: 2px;
}
.menu-item.logout-btn:hover {
    background: #fee2e2;
    color: #fff;
}


    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-title"><i class="fas fa-user-tie"></i>Nhân viên</div>
        <div class="menu-item active" onclick="showPanel('customers', this)"><i class="fas fa-users"></i><span>Khách hàng</span></div>
        <div class="menu-item" onclick="showPanel('reminders', this)"><i class="fas fa-bell"></i><span>Nhắc nhở</span></div>
        <div class="menu-item" onclick="showPanel('appointments', this)"><i class="fas fa-calendar-check"></i><span>Lịch hẹn</span></div>
        <div class="menu-item" onclick="showPanel('view-appointments', this)"><i class="fas fa-calendar-days"></i><span>Xem lịch hẹn</span></div>
        <div class="menu-item" onclick="showPanel('reports', this)"><i class="fas fa-chart-line"></i><span>Doanh thu</span></div>
        <div class="menu-item" onclick="showPanel('services', this)"><i class="fas fa-list-check"></i><span>Dịch vụ</span></div>
        <div class="menu-item" onclick="showPanel('health', this)"><i class="fas fa-heartbeat"></i><span>Sức khỏe</span></div>
   <div class="menu-item logout-btn" onclick="employeeLogout()" style="margin-top:auto; color:var(--danger);">
        <i class="fas fa-sign-out-alt"></i> Đăng xuất
    </div>
    </div>
    <div class="content"><div id="app"></div></div>
    <div id="modal-overlay" class="modal-overlay"></div>
    <div id="toast" class="toast"></div>
<script>
// ==== Dữ liệu mẫu ====
const db = {
    customers: [
        {id: 1, name: 'Nguyễn Văn An', email: 'nguyenvanan@email.com', phone: '0123456789', pet: 'Mèo Anh lông ngắn'},
        {id: 2, name: 'Trần Thị Bình', email: 'tranthib@email.com', phone: '0987654321', pet: 'Chó Poodle'},
        {id: 3, name: 'Lê Hoàng Cường', email: 'lehoangc@email.com', phone: '0369852147', pet: 'Chó Corgi'},
        {id: 4, name: 'Phạm Mai Dung', email: 'phammd@email.com', phone: '0912345678', pet: 'Mèo Ba Tư'},
        {id: 5, name: 'Hoàng Văn Em', email: 'hoangve@email.com', phone: '0898765432', pet: 'Chó Husky'},
        {id: 6, name: 'Đỗ Thị Phương', email: 'dothip@email.com', phone: '0977123456', pet: 'Mèo Munchkin'},
        {id: 7, name: 'Vũ Đức Giàu', email: 'vuducg@email.com', phone: '0888999777', pet: 'Chó Golden'},
        {id: 8, name: 'Mai Thu Hà', email: 'maithuha@email.com', phone: '0909090909', pet: 'Mèo Ragdoll'}
    ],
    reminders: [
        {id: 1, customer: 'Nguyễn Văn An', type: 'Tiêm phòng', date: '2023-06-15', status: 'pending'},
        {id: 2, customer: 'Trần Thị Bình', type: 'Tái khám', date: '2023-06-20', status: 'confirmed'},
        {id: 3, customer: 'Lê Hoàng Cường', type: 'Tẩy giun', date: '2023-06-18', status: 'pending'},
        {id: 4, customer: 'Phạm Mai Dung', type: 'Tiêm vaccine', date: '2023-06-25', status: 'confirmed'},
        {id: 5, customer: 'Hoàng Văn Em', type: 'Kiểm tra định kỳ', date: '2023-06-22', status: 'pending'},
        {id: 6, customer: 'Đỗ Thị Phương', type: 'Nhắc tái khám', date: '2023-06-19', status: 'confirmed'}
    ],
    appointments: [
        {id: 1, customer: 'Nguyễn Văn An', service: 'Khám tổng quát', datetime: '2023-06-16T10:00', status: 'confirmed'},
        {id: 2, customer: 'Trần Thị Bình', service: 'Spa - Grooming', datetime: '2023-06-18T14:00', status: 'pending'},
        {id: 3, customer: 'Lê Hoàng Cường', service: 'Tiêm phòng', datetime: '2023-06-15T09:30', status: 'confirmed'},
        {id: 4, customer: 'Phạm Mai Dung', service: 'Cắt tỉa lông', datetime: '2023-06-17T15:30', status: 'pending'},
        {id: 5, customer: 'Hoàng Văn Em', service: 'Điều trị nội trú', datetime: '2023-06-19T08:00', status: 'confirmed'},
        {id: 6, customer: 'Đỗ Thị Phương', service: 'Siêu âm', datetime: '2023-06-20T11:00', status: 'pending'}
    ],
    viewAppointments: [
        {id: 1, customer: 'Mai Thu Hà', service: 'Cắt tỉa lông', datetime: '2023-06-20T09:30', status: 'pending'},
        {id: 2, customer: 'Vũ Đức Giàu', service: 'Khám định kỳ', datetime: '2023-06-21T14:00', status: 'confirmed'},
        {id: 3, customer: 'Nguyễn Văn An', service: 'Tắm spa', datetime: '2023-06-22T10:00', status: 'pending'}
    ],
    reports: [
        {month: '01/2023', revenue: '156,000,000'},
        {month: '02/2023', revenue: '142,500,000'},
        {month: '03/2023', revenue: '168,300,000'},
        {month: '04/2023', revenue: '145,800,000'},
        {month: '05/2023', revenue: '178,200,000'},
        {month: '06/2023', revenue: '162,400,000'}
    ],
    services: [
        {service: 'Khám tổng quát', count: 245, revenue: '122,500,000'},
        {service: 'Spa - Grooming', count: 180, revenue: '90,000,000'},
        {service: 'Tiêm phòng', count: 156, revenue: '78,000,000'},
        {service: 'Phẫu thuật', count: 42, revenue: '210,000,000'},
        {service: 'Siêu âm', count: 98, revenue: '49,000,000'},
        {service: 'Điều trị nội trú', count: 36, revenue: '180,000,000'}
    ],
    health: [
        {pet: 'Mèo Anh lông ngắn (An)', index: 'Khỏe mạnh', note: 'Cân nặng ổn định, ăn uống tốt'},
        {pet: 'Chó Poodle (Bình)', index: 'Cần theo dõi', note: 'Gần đây kém ăn'},
        {pet: 'Chó Corgi (Cường)', index: 'Khỏe mạnh', note: 'Vận động tốt'},
        {pet: 'Mèo Ba Tư (Dung)', index: 'Đang điều trị', note: 'Đang uống kháng sinh'},
        {pet: 'Chó Husky (Em)', index: 'Khỏe mạnh', note: 'Mới tiêm phòng đầy đủ'},
        {pet: 'Mèo Munchkin (Phương)', index: 'Cần theo dõi', note: 'Cần tăng cân'}
    ]
};
// ====== Toast & Modal dùng chung ======
function toast(msg, type='primary') {
    const t = document.getElementById('toast');
    t.innerHTML = `<i class="fas ${type==='success'?'fa-check-circle':type==='danger'?'fa-times-circle':'fa-info-circle'}"></i><span>${msg}</span>`;
    t.style.background = type==='danger'?'#fee2e2':type==='success'?'#dcfce7':'#fff';
    t.style.color = type==='danger'?'#dc2626':type==='success'?'#15803d':'#4f46e5';
    t.classList.add('active');
    setTimeout(()=>t.classList.remove('active'),2000);
}
function showModal(html, onSubmit) {
    const overlay = document.getElementById('modal-overlay');
    overlay.innerHTML = `<div class="modal">${html}<button class="modal-close" onclick="closeModal()"><i class='fas fa-times'></i></button></div>`;
    overlay.classList.add('active');
    const form = overlay.querySelector('form');
    if (form && onSubmit) form.onsubmit = e => {
        e.preventDefault();
        const fd = {};
        form.querySelectorAll('[name]').forEach(i=>fd[i.name]=i.value);
        onSubmit(fd); closeModal();
    }
}
function closeModal() {document.getElementById('modal-overlay').classList.remove('active');}
function confirmDelete(msg, cb) {
    showModal(`
        <div class="modal-title">Xác nhận xóa</div>
        <div style="text-align:center;font-size:15px;margin:20px 0">${msg}</div>
        <div class="modal-footer">
            <button type="button" class="btn btn-danger" onclick="handleDeleteConfirm(true)">Xóa</button>
            <button type="button" class="btn btn-primary" onclick="handleDeleteConfirm(false)">Hủy</button>
        </div>
    `); window._deleteCallback=cb;
}
function handleDeleteConfirm(confirmed) {
    closeModal();
    if (confirmed && window._deleteCallback) {window._deleteCallback();window._deleteCallback=null;}
}
function formatDateTime(str) {
    if (!str) return '';
    let [date, time] = str.split('T');
    let [y, m, d] = date.split('-');
    return `${d}/${m}/${y} ${time}`;
}
// ==== CRUD render cho từng panel ====
function renderCustomers(q='') {
    let data = db.customers.filter(c=>c.name.toLowerCase().includes(q.toLowerCase())||c.pet.toLowerCase().includes(q.toLowerCase()));
    document.getElementById('app').innerHTML = `
        <div class="panel active">
            <h2>Quản lý khách hàng</h2>
            <div class="search-bar">
                <input type="text" id="customer-search" class="search-input" placeholder="Tìm kiếm khách hàng..." value="${q}">
                <button class="btn btn-primary"><i class="fas fa-search"></i></button>
                <button class="btn btn-success" id="add-customer-btn"><i class="fas fa-plus"></i> Thêm khách</button>
            </div>
            <div class="table-container">
                <table>
                    <thead><tr><th>Họ tên</th><th>Email</th><th>Số điện thoại</th><th>Thú cưng</th><th>Thao tác</th></tr></thead>
                    <tbody>${data.map(c=>`
                        <tr>
                            <td>${c.name}</td>
                            <td>${c.email}</td>
                            <td>${c.phone}</td>
                            <td>${c.pet}</td>
                            <td>
                                <button class="btn btn-primary" onclick="editCustomer(${c.id})"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-danger" onclick="delCustomer(${c.id})"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`).join('')}
                    </tbody>
                </table>
            </div>
        </div>`;
    document.getElementById('customer-search').oninput = e => renderCustomers(e.target.value);
    document.getElementById('add-customer-btn').onclick = () => {
        showModal(`
            <div class="modal-title">Thêm khách hàng</div>
            <form>
                <div class="form-group"><label class="form-label">Họ tên</label><input name="name" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Email</label><input name="email" type="email" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Số điện thoại</label><input name="phone" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Thú cưng</label><input name="pet" class="form-input" required></div>
                <div class="modal-footer"><button class="btn btn-success" type="submit">Thêm</button></div>
            </form>
        `, fd => {db.customers.push({...fd, id: Date.now()}); toast('Thêm khách hàng thành công!', 'success'); renderCustomers('');});
    };
}
function editCustomer(id) {
    let c = db.customers.find(x=>x.id==id);
    showModal(`
        <div class="modal-title">Sửa khách hàng</div>
        <form>
            <div class="form-group"><label class="form-label">Họ tên</label><input name="name" class="form-input" required value="${c.name}"></div>
            <div class="form-group"><label class="form-label">Email</label><input name="email" type="email" class="form-input" required value="${c.email}"></div>
            <div class="form-group"><label class="form-label">Số điện thoại</label><input name="phone" class="form-input" required value="${c.phone}"></div>
            <div class="form-group"><label class="form-label">Thú cưng</label><input name="pet" class="form-input" required value="${c.pet}"></div>
            <div class="modal-footer"><button class="btn btn-success" type="submit">Lưu</button></div>
        </form>
    `, fd => {Object.assign(c, fd); toast('Cập nhật khách hàng thành công!', 'success'); renderCustomers('');});
}
function delCustomer(id) {
    confirmDelete('Bạn có chắc muốn xóa khách hàng này không?', () => {
        db.customers = db.customers.filter(c=>c.id!=id);
        toast('Xóa khách hàng thành công!', 'danger');
        renderCustomers('');
    });
}
function renderReminders(q='') {
    let data = db.reminders.filter(r =>
        r.customer.toLowerCase().includes(q.toLowerCase()) ||
        r.type.toLowerCase().includes(q.toLowerCase())
    );
    document.getElementById('app').innerHTML = `
        <div class="panel active">
            <h2>Quản lý nhắc nhở</h2>
            <div class="search-bar">
                <input type="text" id="reminder-search" class="search-input" placeholder="Tìm kiếm nhắc nhở..." value="${q}">
                <button class="btn btn-primary"><i class="fas fa-search"></i></button>
                <button class="btn btn-success" id="add-reminder-btn"><i class="fas fa-plus"></i> Thêm nhắc nhở</button>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Khách hàng</th>
                            <th>Loại nhắc nhở</th>
                            <th>Ngày</th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(r => `
                        <tr>
                            <td>${r.customer}</td>
                            <td>${r.type}</td>
                            <td>${r.date.split('-').reverse().join('/')}</td>
                            <td>
                                <span class="status status-${r.status}">
                                    ${r.status === 'pending' ? 'Chưa gửi' : r.status === 'confirmed' ? 'Đã gửi' : 'Đã hủy'}
                                </span>
                                ${r.status === 'pending' ? `
                                    <button class="btn btn-success btn-sm" onclick="confirmReminder(${r.id})" style="margin-left:6px">Gửi</button>
                                    <button class="btn btn-danger btn-sm" onclick="cancelReminder(${r.id})" style="margin-left:4px">Hủy</button>
                                ` : ''}
                            </td>
                            <td>
                                <button class="btn btn-primary" onclick="editReminder(${r.id})"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-danger" onclick="delReminder(${r.id})"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>`;
    document.getElementById('reminder-search').oninput = e => renderReminders(e.target.value);
    document.getElementById('add-reminder-btn').onclick = () => {
        showModal(`
            <div class="modal-title">Thêm nhắc nhở</div>
            <form>
                <div class="form-group"><label class="form-label">Khách hàng</label><input name="customer" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Loại nhắc nhở</label><input name="type" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Ngày</label><input name="date" type="date" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Trạng thái</label>
                    <select name="status" class="form-input">
                        <option value="pending">Chưa gửi</option>
                        <option value="confirmed">Đã gửi</option>
                    </select>
                </div>
                <div class="modal-footer"><button class="btn btn-success" type="submit">Thêm</button></div>
            </form>
        `, fd => {
            db.reminders.push({...fd, id: Date.now()});
            toast('Thêm nhắc nhở thành công!', 'success');
            renderReminders('');
        });
    };
}

// Thêm phía dưới, ngoài hàm renderReminders:
function confirmReminder(id) {
    let r = db.reminders.find(x => x.id == id);
    if (r && r.status === 'pending') {
        r.status = 'confirmed';
        toast('Đã gửi nhắc nhở!', 'success');
        renderReminders('');
    }
}
function cancelReminder(id) {
    let r = db.reminders.find(x => x.id == id);
    if (r && r.status === 'pending') {
        r.status = 'cancelled';
        toast('Đã hủy nhắc nhở!', 'danger');
        renderReminders('');
    }
}
function editReminder(id) {
    let r = db.reminders.find(x=>x.id==id);
    showModal(`
        <div class="modal-title">Sửa nhắc nhở</div>
        <form>
            <div class="form-group"><label class="form-label">Khách hàng</label><input name="customer" class="form-input" required value="${r.customer}"></div>
            <div class="form-group"><label class="form-label">Loại nhắc nhở</label><input name="type" class="form-input" required value="${r.type}"></div>
            <div class="form-group"><label class="form-label">Ngày</label><input name="date" type="date" class="form-input" required value="${r.date}"></div>
            <div class="form-group"><label class="form-label">Trạng thái</label>
                <select name="status" class="form-input">
                    <option value="pending" ${r.status=='pending'?'selected':''}>Chưa gửi</option>
                    <option value="confirmed" ${r.status=='confirmed'?'selected':''}>Đã gửi</option>
                </select>
            </div>
            <div class="modal-footer"><button class="btn btn-success" type="submit">Lưu</button></div>
        </form>
    `, fd => {Object.assign(r, fd); toast('Cập nhật nhắc nhở thành công!', 'success'); renderReminders('');});
}
function delReminder(id) {
    confirmDelete('Bạn có chắc muốn xóa nhắc nhở này không?', () => {
        db.reminders = db.reminders.filter(r=>r.id!=id);
        toast('Xóa nhắc nhở thành công!', 'danger');
        renderReminders('');
    });
}
function renderAppointments(q='') {
    let data = db.appointments.filter(a =>
        a.customer.toLowerCase().includes(q.toLowerCase()) ||
        a.service.toLowerCase().includes(q.toLowerCase())
    );

    document.getElementById('app').innerHTML = `
        <div id="appointments-panel" class="panel active">
            <h2>Quản lý lịch hẹn</h2>
            <div class="search-bar">
                <input type="text" id="appointment-search" class="search-input" 
                    placeholder="Tìm kiếm lịch hẹn..." value="${q}">
                <button class="btn btn-primary"><i class="fas fa-search"></i></button>
                <button class="btn btn-success" id="add-appointment-btn">
                    <i class="fas fa-plus"></i> Thêm lịch hẹn
                </button>
            </div>
            <div class="calendar" id="calendar"></div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Khách hàng</th>
                            <th>Dịch vụ</th>
                            <th>Ngày giờ</th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(a => `
                            <tr>
                                <td>${a.customer}</td>
                                <td>${a.service}</td>
                                <td>${formatDateTime(a.datetime)}</td>
                                <td>
                                    <span class="status status-${a.status}">
                                        ${a.status === 'pending' ? 'Chờ xác nhận' : a.status === 'confirmed' ? 'Đã xác nhận' : 'Đã hủy'}
                                    </span>
                                    ${a.status === 'pending' ? `
                                        <button class="btn btn-success btn-sm" onclick="confirmAppointment(${a.id})" style="margin-left:6px">Xác nhận</button>
                                        <button class="btn btn-danger btn-sm" onclick="cancelAppointment(${a.id})" style="margin-left:4px">Hủy</button>
                                    ` : ''}
                                </td>
                                <td>
                                    <button class="btn btn-primary" onclick="editAppointment(${a.id})"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-danger" onclick="delAppointment(${a.id})"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;

    document.getElementById('appointment-search').oninput = e => renderAppointments(e.target.value);
    document.getElementById('add-appointment-btn').onclick = () => {
        showModal(`
            <div class="modal-title">Thêm lịch hẹn</div>
            <form>
                <div class="form-group"><label class="form-label">Khách hàng</label><input name="customer" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Dịch vụ</label><input name="service" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Ngày giờ</label><input name="datetime" type="datetime-local" class="form-input" required></div>
                <div class="form-group"><label class="form-label">Trạng thái</label>
                    <select name="status" class="form-input">
                        <option value="pending">Chờ xác nhận</option>
                        <option value="confirmed">Đã xác nhận</option>
                    </select>
                </div>
                <div class="modal-footer"><button class="btn btn-success" type="submit">Thêm</button></div>
            </form>
        `, fd => {
            db.appointments.push({...fd, id: Date.now()});
            toast('Đã thêm lịch hẹn!', 'success');
            renderAppointments('');
        });
    };
    renderCalendar();
}

// Thêm phía dưới ngoài hàm renderAppointments:
function confirmAppointment(id) {
    let a = db.appointments.find(x => x.id == id);
    if (a && a.status === 'pending') {
        a.status = 'confirmed';
        toast('Đã xác nhận lịch hẹn!', 'success');
        renderAppointments('');
    }
}
function cancelAppointment(id) {
    let a = db.appointments.find(x => x.id == id);
    if (a && a.status === 'pending') {
        a.status = 'cancelled';
        toast('Đã hủy lịch hẹn!', 'danger');
        renderAppointments('');
    }
}

function editAppointment(id) {
    let a = db.appointments.find(x=>x.id==id);
    showModal(`
        <div class="modal-title">Sửa lịch hẹn</div>
        <form>
            <div class="form-group"><label class="form-label">Khách hàng</label><input name="customer" class="form-input" required value="${a.customer}"></div>
            <div class="form-group"><label class="form-label">Dịch vụ</label><input name="service" class="form-input" required value="${a.service}"></div>
            <div class="form-group"><label class="form-label">Ngày giờ</label><input name="datetime" type="datetime-local" class="form-input" required value="${a.datetime}"></div>
            <div class="form-group"><label class="form-label">Trạng thái</label>
                <select name="status" class="form-input">
                    <option value="pending" ${a.status=='pending'?'selected':''}>Chờ xác nhận</option>
                    <option value="confirmed" ${a.status=='confirmed'?'selected':''}>Đã xác nhận</option>
                </select>
            </div>
            <div class="modal-footer"><button class="btn btn-success" type="submit">Lưu</button></div>
        </form>
    `, fd => {Object.assign(a, fd); toast('Cập nhật lịch hẹn thành công!', 'success'); renderAppointments('');});
}
function delAppointment(id) {
    confirmDelete('Bạn có chắc muốn xóa lịch hẹn này không?', () => {
        db.appointments = db.appointments.filter(a=>a.id!=id);
        toast('Xóa lịch hẹn thành công!', 'danger');
        renderAppointments('');
    });
}
function renderCalendar() {
    const calendar = document.getElementById('calendar');
    if (!calendar) return;
    calendar.innerHTML = '';
    const year = 2023, month = 6; // June
    const days = new Date(year, month, 0).getDate();
    const weekdays = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
    weekdays.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-header';
        dayHeader.textContent = day;
        calendar.appendChild(dayHeader);
    });
    for(let i=1;i<=days;i++) {
        const day = document.createElement('div');
        day.className = 'calendar-day';
        day.textContent = i;
        const hasAppointments = db.appointments.some(a => {
            const d = new Date(a.datetime);
            return d.getDate()===i&&d.getMonth()==month-1&&d.getFullYear()===year;
        });
        if(hasAppointments) {
            day.style.backgroundColor = '#e0e7ff';
            day.style.color = '#4f46e5';
            day.style.fontWeight = '600';
        }
        day.onclick = function() {
            document.querySelectorAll('.calendar-day').forEach(d=>{d.classList.remove('active');const oldList=d.querySelector('.day-appointments');if(oldList)oldList.remove();});
            this.classList.add('active');
            const appointments = db.appointments.filter(a => {
                const d = new Date(a.datetime);
                return d.getDate()===i&&d.getMonth()==month-1&&d.getFullYear()===year;
            });
            const list = document.createElement('div');
            list.className = 'day-appointments';
            if (appointments.length) {
                list.innerHTML = `<h4 style="margin-bottom:8px;color:#4f46e5">Lịch hẹn ngày ${i}/${month}/${year}</h4>${appointments.map(a=>`
                    <div class="day-appointment-item">
                        <div style="font-weight:500">${a.customer}</div>
                        <div style="color:#64748b;font-size:14px">${a.service} - ${a.datetime.split('T')[1]}
                            <span class="status status-${a.status}" style="margin-left:8px">${a.status==='pending'?'Chờ xác nhận':'Đã xác nhận'}</span>
                        </div>
                    </div>`).join('')}`;
            } else list.innerHTML = `<h4 style="margin-bottom:8px;color:#4f46e5">Lịch hẹn ngày ${i}/${month}/${year}</h4><div style="color:#64748b;text-align:center;padding:12px">Không có lịch hẹn</div>`;
            this.appendChild(list);
        };
        calendar.appendChild(day);
    }
}
function renderViewAppointments() {
    let data = db.viewAppointments;
    document.getElementById('app').innerHTML = `
        <div class="panel active">
            <h2>Xem lịch hẹn</h2>
            <div class="table-container">
                <table>
                    <thead><tr><th>Khách hàng</th><th>Dịch vụ</th><th>Ngày giờ</th><th>Trạng thái</th></tr></thead>
                    <tbody>${data.map(a=>`
                        <tr>
                            <td>${a.customer}</td>
                            <td>${a.service}</td>
                            <td>${formatDateTime(a.datetime)}</td>
                            <td><span class="status status-${a.status}">${a.status==='pending'?'Chờ xác nhận':'Đã xác nhận'}</span></td>
                        </tr>`).join('')}
                    </tbody>
                </table>
            </div>
        </div>`;
}
function renderReports() {
    let data = db.reports;
    document.getElementById('app').innerHTML = `
        <div class="panel active">
            <h2>Báo cáo doanh thu</h2>
            <div style="display:flex; gap:20px; margin-bottom:30px">
                <div style="flex:1"><canvas id="revenueChart"></canvas></div>
                <div style="flex:1"><canvas id="revenueBarChart"></canvas></div>
            </div>
            <div class="table-container">
                <table>
                    <thead><tr><th>Tháng</th><th>Doanh thu</th></tr></thead>
                    <tbody>${data.map(r=>`
                        <tr>
                            <td>${r.month}</td>
                            <td>${r.revenue} VND</td>
                        </tr>`).join('')}
                    </tbody>
                </table>
            </div>
        </div>`;
    const ctx = document.getElementById('revenueChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.map(r => r.month),
            datasets: [{
                label: 'Doanh thu (VNĐ)',
                data: data.map(r => parseInt(r.revenue.replace(/,/g, ''))/1000000),
                borderColor: '#4f46e5',
                tension: 0.3,
                fill: true,
                backgroundColor: 'rgba(79, 70, 229, 0.1)'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {display: true,text: 'Biểu đồ doanh thu theo tháng',font: { size: 16 }},
                legend: {position: 'bottom'}
            },
            scales: {y: {beginAtZero: true,title: {display: true,text: 'Triệu VNĐ'}}}
        }
    });
    const ctx2 = document.getElementById('revenueBarChart').getContext('2d');
    new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: data.map(r => r.month),
            datasets: [{
                label: 'Doanh thu (VNĐ)',
                data: data.map(r => parseInt(r.revenue.replace(/,/g, ''))/1000000),
                backgroundColor: 'rgba(79, 70, 229, 0.7)',
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {display: true,text: 'So sánh doanh thu các tháng',font: { size: 16 }},
                legend: {position: 'bottom'}
            },
            scales: {y: {beginAtZero: true,title: {display: true,text: 'Triệu VNĐ'}}}
        }
    });
}
function renderServices() {
    let data = db.services;
    document.getElementById('app').innerHTML = `
        <div class="panel active">
            <h2>Thống kê dịch vụ</h2>
            <div class="table-container">
                <table>
                    <thead><tr><th>Dịch vụ</th><th>Số lượt</th><th>Doanh thu</th></tr></thead>
                    <tbody>${data.map(s=>`
                        <tr>
                            <td>${s.service}</td>
                            <td>${s.count}</td>
                            <td>${s.revenue} VND</td>
                        </tr>`).join('')}
                    </tbody>
                </table>
            </div>
        </div>`;
}
function renderHealth() {
    let data = db.health;
    document.getElementById('app').innerHTML = `
        <div class="panel active">
            <h2>Xu hướng sức khỏe</h2>
            <div class="table-container">
                <table>
                    <thead><tr><th>Thú cưng</th><th>Chỉ số sức khỏe</th><th>Ghi chú</th></tr></thead>
                    <tbody>${data.map(h=>`
                        <tr>
                            <td>${h.pet}</td>
                            <td>${h.index}</td>
                            <td>${h.note}</td>
                        </tr>`).join('')}
                    </tbody>
                </table>
            </div>
        </div>`;
}
// ==== Chuyển tab (panel) ====
function showPanel(panel, el) {
    document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active'));
    if(el) el.classList.add('active');
    switch(panel) {
        case 'customers': renderCustomers(''); break;
        case 'reminders': renderReminders(''); break;
        case 'appointments': renderAppointments(''); break;
        case 'view-appointments': renderViewAppointments(); break;
        case 'reports': renderReports(); break;
        case 'services': renderServices(); break;
        case 'health': renderHealth(); break;
    }
}
function employeeLogout() {
    if (confirm('Bạn chắc chắn muốn đăng xuất?')) {
        // Chuyển về trang đăng nhập nhân viên (sửa lại tên file nếu bạn muốn)
        window.location.href = "DangNhap    .html";
    }
}

window.onload = ()=>{ renderCustomers(''); };
</script>
</body>
</html>
